{% extends "base.html" %}

{% block title %}íšŒì˜ - ë¶€ì‚°í€´ì–´í–‰ë™ TODO{% endblock %}

{% block content %}
<div class="page-header">
    <h1>íšŒì˜</h1>
    <p class="page-subtitle">{{ today_str }} ê¸°ì¤€ Â· íšŒì˜ì—ì„œ í•¨ê»˜ ì ê²€í•  ë‚´ìš©</p>
</div>

<!-- íšŒì˜ í˜ì´ì§€ ì•ˆë‚´ -->
<div class="info-box">
    <div class="info-box-title">ğŸ“Œ ì´ í˜ì´ì§€ ì‚¬ìš©ë²•</div>
    <div class="info-box-content">
        <p>íšŒì˜ ì‹œê°„ì— ì´ í™”ë©´ì„ ë„ì›Œë‘ê³  í•¨ê»˜ ì ê²€í•˜ì„¸ìš”.</p>
        <ul class="info-list">
            <li><strong>30ì¼ ì´ë‚´ ì¼ì •</strong>: ê³§ ë‹¤ê°€ì˜¤ëŠ” ì¼ì •ë“¤ì…ë‹ˆë‹¤. <span class="badge badge-pending">ê¸°íš í™•ì • í•„ìš”</span>ê°€ í‘œì‹œëœ ì¼ì •ì€ íšŒì˜ì—ì„œ ì„¸ë¶€ ê³„íšì„ í™•ì •í•´ì•¼ í•©ë‹ˆë‹¤.</li>
            <li><strong>ì‚¬ì „ ì¤€ë¹„ í•„ìš”</strong>: ì¼ì •ì€ 30ì¼ ì´í›„ì§€ë§Œ, ë§ˆê°ì´ 30ì¼ ì´ë‚´ì¸ ì‹¤ë¬´ì…ë‹ˆë‹¤. ë¯¸ë¦¬ ì¤€ë¹„í•´ì•¼ í•  ê²ƒë“¤ì´ì—ìš”.</li>
        </ul>
    </div>
</div>

<!-- ì—°ì¤‘ ì¼ì • ì•Œë¦¼ -->
{% if yearly_schedules %}
<div class="yearly-reminder">
    <div class="yearly-reminder-icon">ğŸ“…</div>
    <div class="yearly-reminder-content">
        <div class="yearly-reminder-title">ì—°ì¤‘ 1íšŒ ì§„í–‰í•˜ëŠ” ì¼ì •ì´ ìˆìŠµë‹ˆë‹¤</div>
        <div class="yearly-reminder-desc">ì•„ë˜ ì¼ì •ì€ ì—°ì¤‘ ì ì ˆí•œ ì‹œê¸°ì— ê¸°íšì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ë²ˆ ë‹¬ì— ì§„í–‰í• ì§€ ë…¼ì˜í•´ë³´ì„¸ìš”.</div>
        <div class="yearly-reminder-list">
            {% for schedule in yearly_schedules %}
            <a href="{{ url_for('schedule_detail', schedule_id=schedule.id) }}" class="yearly-reminder-item">
                <span class="yearly-reminder-item-title">{{ schedule.title }}</span>
                <span class="badge badge-category">{{ schedule.category }}</span>
                {% if not schedule.is_confirmed %}<span class="badge badge-pending">ë¯¸í™•ì •</span>{% endif %}
            </a>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- 30ì¼ ì´ë‚´ ì¼ì • -->
<div class="section">
    <div class="section-header">
        <div class="section-title">ğŸ“… 30ì¼ ì´ë‚´ ì¼ì •</div>
        <span class="section-count">{{ upcoming_schedules|length }}ê±´</span>
    </div>
    <p class="section-description">ê³§ ì§„í–‰ë˜ëŠ” ì¼ì •ê³¼ í•´ë‹¹ ì‹¤ë¬´ ëª©ë¡ì…ë‹ˆë‹¤. ì²´í¬ë°•ìŠ¤ë¥¼ ëˆŒëŸ¬ ì™„ë£Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

    {% if upcoming_schedules %}
    <div class="meeting-list">
        {% for schedule in upcoming_schedules %}
        <div class="meeting-card">
            <div class="meeting-card-header">
                <div class="meeting-card-title">
                    <a href="{{ url_for('schedule_detail', schedule_id=schedule.id) }}" title="ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™">{{ schedule.title }}</a>
                </div>
                <div class="meeting-card-meta">
                    <span class="badge badge-category">{{ schedule.category }}</span>
                    {% if schedule.is_confirmed %}
                    <span class="badge badge-confirmed" title="ê¸°íšì´ í™•ì •ëœ ì¼ì •ì…ë‹ˆë‹¤">í™•ì •</span>
                    {% else %}
                    <span class="badge badge-pending" title="íšŒì˜ì—ì„œ ê¸°íšì„ í™•ì •í•´ì£¼ì„¸ìš”">ê¸°íš í™•ì • í•„ìš”</span>
                    {% endif %}
                    <span class="meeting-date">{{ schedule.date | date_kr }}</span>
                    <span class="dday {{ schedule.dday_class }}">{{ schedule.dday_text }}</span>
                </div>
            </div>

            {% if schedule.tasks %}
            <div class="meeting-card-tasks-header">
                <span class="label">ì‹¤ë¬´ ëª©ë¡</span>
                <span class="hint">ì™„ë£Œí•œ í•­ëª©ì€ ì²´í¬í•˜ì„¸ìš”</span>
            </div>
            <ul class="task-list compact">
                {% for task in schedule.tasks %}
                <li class="task-item {% if task.is_completed %}completed{% endif %}" data-task-id="{{ task.id }}">
                    <button type="button" class="checkbox-btn {% if task.is_completed %}checked{% endif %}" onclick="toggleTask({{ task.id }}, this)" title="í´ë¦­í•˜ì—¬ ì™„ë£Œ/ë¯¸ì™„ë£Œ ì „í™˜">
                        {% if task.is_completed %}âœ“{% endif %}
                    </button>
                    <div class="task-content">
                        <div class="task-text">
                            {% if task.is_draft %}<span class="badge badge-draft" title="ì•„ì§ í™•ì •ë˜ì§€ ì•Šì€ ì‹¤ë¬´">ê°€ì•ˆ</span> {% endif %}
                            {% if task.is_idea %}<span class="badge badge-idea" title="ì„¸ë¶€ë‚´ìš© ì•„ì´ë””ì–´">ì•„ì´ë””ì–´</span> {% endif %}
                            {{ task.content }}
                        </div>
                        <div class="task-meta">
                            {% if task.deadline %}
                            <span class="deadline-date">{{ task.deadline | date_kr }}</span>
                            <span class="dday {{ task.deadline | dday_class }}">{{ task.deadline | dday }}</span>
                            {% endif %}
<span class="assignee {% if not task.activist_name %}unassigned{% endif %}" title="ë‹´ë‹¹ì">{{ task.activist_name or 'ë¯¸ì •' }}</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <form action="{{ url_for('task_delete', task_id=task.id) }}" method="post" class="inline-form"
                              onsubmit="return confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                            <button type="submit" class="btn btn-danger btn-sm">ì‚­ì œ</button>
                        </form>
                    </div>
                </li>
                {% endfor %}
            </ul>
            {% endif %}
            <!-- ì‹¤ë¬´ ì¶”ê°€ í¼ -->
            <form action="{{ url_for('task_add') }}" method="post" class="add-form compact">
                <input type="hidden" name="schedule_id" value="{{ schedule.id }}">
                <input type="hidden" name="referer" value="{{ request.url }}">
                <input type="text" name="content" placeholder="+ ì‹¤ë¬´ ì¶”ê°€..." required>
                <select name="activist_id" class="form-control" style="width: auto;">
                    <option value="">ë‹´ë‹¹</option>
                    {% for activist in activists %}
                    <option value="{{ activist.id }}">{{ activist.name }}</option>
                    {% endfor %}
                </select>
                <input type="date" name="deadline" class="form-control" style="width: 130px;" title="ë§ˆê°ì¼">
                <button type="submit" class="btn btn-primary btn-sm">ì¶”ê°€</button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">ğŸ“­</div>
        <div class="empty-message">30ì¼ ì´ë‚´ ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</div>
        <div class="empty-hint">ìƒˆ ì¼ì •ì„ ì¶”ê°€í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
    </div>
    {% endif %}
</div>

<!-- 30ì¼ ì´í›„ ì¼ì • ì¤‘ ë§ˆê° ì„ë°• ì‹¤ë¬´ -->
<div class="section">
    <div class="section-header">
        <div class="section-title">â° ì‚¬ì „ ì¤€ë¹„ í•„ìš”</div>
        <span class="section-count">{{ future_tasks|length }}ê±´</span>
    </div>
    <p class="section-description">ì¼ì • ìì²´ëŠ” 30ì¼ ì´í›„ì§€ë§Œ, ë§ˆê°ì´ 30ì¼ ì´ë‚´ì¸ ì‹¤ë¬´ì…ë‹ˆë‹¤. ë¯¸ë¦¬ ì¤€ë¹„í•´ì•¼ í•˜ëŠ” ê²ƒë“¤ì´ì—ìš”!</p>

    {% if future_schedules %}
    <div class="meeting-list">
        {% for schedule in future_schedules %}
        <div class="meeting-card future-schedule">
            <div class="meeting-card-header">
                <div class="meeting-card-title">
                    <a href="{{ url_for('schedule_detail', schedule_id=schedule.id) }}" title="ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™">{{ schedule.title }}</a>
                </div>
                <div class="meeting-card-meta">
                    <span class="badge badge-category">{{ schedule.category }}</span>
                    {% if schedule.is_confirmed %}
                    <span class="badge badge-confirmed" title="ê¸°íšì´ í™•ì •ëœ ì¼ì •ì…ë‹ˆë‹¤">í™•ì •</span>
                    {% else %}
                    <span class="badge badge-pending" title="íšŒì˜ì—ì„œ ê¸°íšì„ í™•ì •í•´ì£¼ì„¸ìš”">ê¸°íš í™•ì • í•„ìš”</span>
                    {% endif %}
                    <span class="meeting-date">ì¼ì •: {{ schedule.date | date_kr }}</span>
                    <span class="dday {{ schedule.dday_class }}">{{ schedule.dday_text }}</span>
                </div>
            </div>

            {% if schedule.tasks %}
            <div class="meeting-card-tasks-header">
                <span class="label">ë§ˆê° ì„ë°• ì‹¤ë¬´</span>
                <span class="hint">30ì¼ ì´ë‚´ ë§ˆê°</span>
            </div>
            <ul class="task-list compact">
                {% for task in schedule.tasks %}
                <li class="task-item {% if task.is_completed %}completed{% endif %}" data-task-id="{{ task.id }}">
                    <button type="button" class="checkbox-btn {% if task.is_completed %}checked{% endif %}" onclick="toggleTask({{ task.id }}, this)" title="í´ë¦­í•˜ì—¬ ì™„ë£Œ/ë¯¸ì™„ë£Œ ì „í™˜">
                        {% if task.is_completed %}âœ“{% endif %}
                    </button>
                    <div class="task-content">
                        <div class="task-text">
                            {% if task.is_draft %}<span class="badge badge-draft" title="ì•„ì§ í™•ì •ë˜ì§€ ì•Šì€ ì‹¤ë¬´">ê°€ì•ˆ</span> {% endif %}
                            {% if task.is_idea %}<span class="badge badge-idea" title="ì„¸ë¶€ë‚´ìš© ì•„ì´ë””ì–´">ì•„ì´ë””ì–´</span> {% endif %}
                            {{ task.content }}
                        </div>
                        <div class="task-meta">
                            {% if task.deadline %}
                            <span class="deadline-date">{{ task.deadline | date_kr }}</span>
                            <span class="dday {{ task.deadline | dday_class }}">{{ task.deadline | dday }}</span>
                            {% endif %}
                            <span class="assignee {% if not task.activist_name %}unassigned{% endif %}" title="ë‹´ë‹¹ì">{{ task.activist_name or 'ë¯¸ì •' }}</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <form action="{{ url_for('task_delete', task_id=task.id) }}" method="post" class="inline-form"
                              onsubmit="return confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                            <button type="submit" class="btn btn-danger btn-sm">ì‚­ì œ</button>
                        </form>
                    </div>
                </li>
                {% endfor %}
            </ul>
            {% endif %}
            <!-- ì‹¤ë¬´ ì¶”ê°€ í¼ -->
            <form action="{{ url_for('task_add') }}" method="post" class="add-form compact">
                <input type="hidden" name="schedule_id" value="{{ schedule.id }}">
                <input type="hidden" name="referer" value="{{ request.url }}">
                <input type="text" name="content" placeholder="+ ì‹¤ë¬´ ì¶”ê°€..." required>
                <select name="activist_id" class="form-control" style="width: auto;">
                    <option value="">ë‹´ë‹¹</option>
                    {% for activist in activists %}
                    <option value="{{ activist.id }}">{{ activist.name }}</option>
                    {% endfor %}
                </select>
                <input type="date" name="deadline" class="form-control" style="width: 130px;" title="ë§ˆê°ì¼">
                <button type="submit" class="btn btn-primary btn-sm">ì¶”ê°€</button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">âœ¨</div>
        <div class="empty-message">ì‚¬ì „ ì¤€ë¹„ê°€ í•„ìš”í•œ ì‹¤ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤</div>
        <div class="empty-hint">30ì¼ ì´í›„ ì¼ì • ì¤‘ ë§ˆê°ì´ ì„ë°•í•œ ì‹¤ë¬´ê°€ ìˆìœ¼ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
    </div>
    {% endif %}
</div>
{% endblock %}
