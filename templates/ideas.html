{% extends "base.html" %}

{% block title %}ì‚¬ì—… ì•„ì´ë””ì–´ - ë¶€ì‚°í€´ì–´í–‰ë™ TODO{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ì‚¬ì—… ì•„ì´ë””ì–´</h1>
    <p class="page-subtitle">ì¼ì •ê³¼ ë¬´ê´€í•˜ê²Œ í™œë™ê°€ë“¤ì´ ì œì•ˆí•˜ëŠ” ìƒˆë¡œìš´ ì‚¬ì—… ì•„ì´ë””ì–´</p>
</div>

<!-- ì•ˆë‚´ -->
<div class="info-box">
    <div class="info-box-title">ğŸ’¡ ì´ í˜ì´ì§€ ì‚¬ìš©ë²•</div>
    <div class="info-box-content">
        <p>ë¶€ì‚°í€´ì–´í–‰ë™ì˜ ìƒˆë¡œìš´ ì‚¬ì—… ì•„ì´ë””ì–´ë¥¼ ììœ ë¡­ê²Œ ì œì•ˆí•˜ì„¸ìš”.</p>
        <ul class="info-list">
            <li>íŠ¹ì • ì¼ì •ê³¼ ê´€ê³„ì—†ì´ ë– ì˜¤ë¥´ëŠ” ì•„ì´ë””ì–´ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.</li>
            <li>íšŒì˜ì—ì„œ ë…¼ì˜ í›„ ì±„íƒë˜ë©´ ì²´í¬ í‘œì‹œí•˜ê³ , ìƒˆ ì¼ì •ìœ¼ë¡œ ì¶”ê°€í•˜ì„¸ìš”.</li>
        </ul>
    </div>
</div>

<!-- í•„í„° -->
<div class="filter-bar">
    <div class="filter-group">
        <label class="form-check">
            <input type="checkbox" id="show-adopted" {% if show_adopted %}checked{% endif %}
                   onchange="location.href='{{ url_for('ideas') }}?show_adopted=' + (this.checked ? '1' : '0') + '&activist={{ filter_activist }}'">
            ì±„íƒëœ ì•„ì´ë””ì–´ë„ ë³´ê¸°
        </label>
    </div>
    <div class="filter-group">
        <select class="form-control" onchange="location.href='{{ url_for('ideas') }}?show_adopted={{ '1' if show_adopted else '0' }}&activist=' + this.value">
            <option value="">ì „ì²´ í™œë™ê°€</option>
            {% for activist in activists %}
            <option value="{{ activist.id }}" {% if filter_activist == activist.id %}selected{% endif %}>{{ activist.name }}</option>
            {% endfor %}
        </select>
    </div>
</div>

<!-- ì•„ì´ë””ì–´ ì¶”ê°€ í¼ -->
<div class="section">
    <form action="{{ url_for('idea_add') }}" method="post" class="add-form idea-add-form">
        <input type="text" name="content" placeholder="+ ìƒˆ ì‚¬ì—… ì•„ì´ë””ì–´ ì¶”ê°€... (ì˜ˆ: í€´ì–´ ë…ì„œëª¨ì„ ìš´ì˜)" required>
        <select name="activist_id" class="form-control" style="width: auto;">
            <option value="">ì œì•ˆì</option>
            {% for activist in activists %}
            <option value="{{ activist.id }}">{{ activist.name }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-primary">ì¶”ê°€</button>
    </form>
</div>

<!-- ì•„ì´ë””ì–´ ëª©ë¡ -->
<div class="section">
    <div class="section-header">
        <div class="section-title">ğŸ“ ì•„ì´ë””ì–´ ëª©ë¡</div>
        <span class="section-count">{{ ideas|length }}ê±´</span>
    </div>

    {% if ideas %}
    <ul class="task-list idea-list">
        {% for idea in ideas %}
        <li class="task-item idea-item {% if idea.is_adopted %}completed{% endif %}" data-idea-id="{{ idea.id }}">
            <button type="button" class="checkbox-btn {% if idea.is_adopted %}checked{% endif %}" onclick="toggleIdea({{ idea.id }}, this)" title="í´ë¦­í•˜ì—¬ ì±„íƒ/ë¯¸ì±„íƒ ì „í™˜">
                {% if idea.is_adopted %}âœ“{% endif %}
            </button>
            <div class="task-content">
                <div class="task-text">
                    {% if idea.is_adopted %}<span class="badge badge-adopted">ì±„íƒë¨</span> {% endif %}
                    {{ idea.content }}
                </div>
                <div class="task-meta">
                    <span class="assignee {% if not idea.activist_name %}unassigned{% endif %}" title="ì œì•ˆì">{{ idea.activist_name or 'ìµëª…' }}</span>
                    {% if idea.created_at %}
                    <span class="created-date" title="ì œì•ˆ ì¼ì‹œ">{{ idea.created_at }}</span>
                    {% endif %}
                </div>
            </div>
            <div class="task-actions">
                <form action="{{ url_for('idea_delete', idea_id=idea.id) }}" method="post" class="inline-form"
                      onsubmit="return confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                    <button type="submit" class="btn btn-danger btn-sm">ì‚­ì œ</button>
                </form>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">ğŸ’¡</div>
        <div class="empty-message">
            {% if show_adopted %}ë“±ë¡ëœ ì•„ì´ë””ì–´ê°€ ì—†ìŠµë‹ˆë‹¤
            {% else %}ê²€í†  ì¤‘ì¸ ì•„ì´ë””ì–´ê°€ ì—†ìŠµë‹ˆë‹¤{% endif %}
        </div>
        <div class="empty-hint">ìœ„ ì…ë ¥ë€ì—ì„œ ìƒˆ ì•„ì´ë””ì–´ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”</div>
    </div>
    {% endif %}
</div>

<!-- í•˜ë‹¨ ì•ˆë‚´ -->
<div class="page-footer-hint">
    <div class="hint-item">
        <span class="badge badge-adopted">ì±„íƒë¨</span> íšŒì˜ì—ì„œ ë…¼ì˜ í›„ ì§„í–‰í•˜ê¸°ë¡œ ê²°ì •ëœ ì•„ì´ë””ì–´
    </div>
    <div class="hint-item">
        ì±„íƒëœ ì•„ì´ë””ì–´ëŠ” <a href="{{ url_for('schedule_add') }}">ìƒˆ ì¼ì •</a>ìœ¼ë¡œ ë“±ë¡í•˜ì„¸ìš”
    </div>
</div>

<script>
function toggleIdea(ideaId, checkbox) {
    const ideaItem = checkbox.closest('.idea-item');
    const wasAdopted = ideaItem.classList.contains('completed');

    fetch(`/idea/${ideaId}/toggle`, {
        method: 'POST',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (data.new_status === 1) {
                ideaItem.classList.add('completed');
                checkbox.classList.add('checked');
                checkbox.innerHTML = 'âœ“';
                // ì±„íƒë¨ ë°°ì§€ ì¶”ê°€
                const textEl = ideaItem.querySelector('.task-text');
                if (!textEl.querySelector('.badge-adopted')) {
                    textEl.insertAdjacentHTML('afterbegin', '<span class="badge badge-adopted">ì±„íƒë¨</span> ');
                }
                showToast('ì•„ì´ë””ì–´ê°€ ì±„íƒë˜ì—ˆìŠµë‹ˆë‹¤');
            } else {
                ideaItem.classList.remove('completed');
                checkbox.classList.remove('checked');
                checkbox.innerHTML = '';
                // ì±„íƒë¨ ë°°ì§€ ì œê±°
                const badge = ideaItem.querySelector('.badge-adopted');
                if (badge) badge.remove();
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        location.reload();
    });

    return false;
}
</script>
{% endblock %}
